#!/bin/sh

old_ref=$1
new_ref=$2
branch_switched=$3

if [[ $branch_switched != '1' ]]
then
    exit 0
fi

echo "---- POST CHECKOUT ----"

current_branch=$(git rev-parse --abbrev-ref HEAD)
# hook_dir=$(dirname $0)
root_dir="$(pwd -P)"
gitignores_dir="${root_dir}/.gitignores"
# src="$gitignores_dir/__default.gitignore"
src=__default.gitignore
target=".gitignore"
target_path="${root_dir}/${target}"

# exclude_target='.gitignore'
# if [[ -f "$root_dir/$exclude_target.$current_branch" ]]
if [[ -f "${gitignores_dir}/${current_branch}.gitignore" ]]
# if [[ -f "${gitignores_dir}/${current_branch}.gitignore" ]]
# if [[ -f "${root_dir}/.gitignores/${current_branch}.gitignore" ]]
then
  echo "Prepare to use ${current_branch}.gitignore as gitignore file"
  src="${current_branch}.gitignore"
fi

src_path="${root_dir}/.gitignores/${src}"
echo "$src_path"

cd "$root_dir"
rm "$target_path"
echo "Copy ${src} file in place of ${target}"
ln -s "$src_path" "$target_path"

echo "--- POST CHECKOUT END ---"